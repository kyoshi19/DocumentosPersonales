Module 1: Principles of Performance and Tuning

Lab 1-1: Examining the Environment - Solution
Lab Setup
The instructor will give you a UNIX login and password and explain how to connect to the UNIX host.

Objectives
After completing this lab, you should be able to:
* Describe the Adaptive Server UNIX environment.

Description
In this lab, you will become familiar with the Adaptive Server Unix environment.

Task Outline 
Task 1:  Installing the Student Files
Task 2:  Exploring Adaptive Server UNIX Environment.

Detailed Instructions and Solutions

Task 1: Installing the Student Files
Procedure
1. Insert the Student CD and double-click EDB634_setup_v3.0.exe.
2. You will see a WinZip Self-Extractor dialog.  Enter “c:\” in the Unzip to folder field and click Unzip.



3. You will see a message indicating completion of the extraction.  You may close the WinZip dialog.
4. Open Windows Explorer and navigate to your C:\ drive.  Under the root, you should now have a \Sybase Courses folder with several sub-folders.  
5. Right-click over the \Sybase Courses folder and select Properties.  You will want to make sure the files in \Sybase Courses (and its sub-folders) are not set to Read- only.  If they are, disable that attribute.
6. Verify that you have all required folders and files on your hard disk.








Task 2: Exploring Adaptive Server UNIX Environment
Description
In this task, you will examine UNIX environment variables, Navigate the $SYBASE and $HOME directory structures and you will Explore and reboot your Adaptive Server.

Procedure

  For all labs, you should open two windows (“A” and “B”). Unless instructed otherwise, perform all lab exercises in Window A. 
You use Window B primarily as a console for starting up Adaptive Server. All Adaptive Server system messages are displayed there instead of in your active window. Additionally, Window B saves you from having to change directories whenever the server needs to be restarted.1. Examine the UNIX environment.
a. Boot up your PC and connect to the UNIX server.

 
Your instructor will provide a login/password combination for both the PC and the UNIX server.b. Verify that you have logged into the UNIX server with the correct login name by examining the setting for the $LOGNAME environment variable.

echo $LOGNAME

dub303

c. What is the $HOME variable set to?

echo $HOME

/home/usr/u/dub303

d. What is the $SYBASE variable set to?

echo $SYBASE

/home/usr/u/dub303

 
What is the relationship between your $HOME and $SYBASE directories?
Your $HOME directory is your $SYBASE directory.e. Confirm which directory you are currently in.

pwd

/betadisk/home/dub303 

 
Examine your results carefully! Due to system variations, you may see slightly different output than the solutions show. Sybase Learning Centers use a symbolic link between your $HOME and $SYBASE directories. 
For example, the $HOME and $SYBASE environment variable may both display as /home/usr/u/dub303; but when you change to either directory and use the UNIX command “pwd”, the directory name appears as /betadisk/home/dub303. Functionally, the two directories are identical.
The key point is that your $HOME directory is also your $SYBASE directory.
Please note that your account will more than likely not be dub303, but will be identical to the Linux login provided by the instructor.f. What is the $SYBASE_ASE variable set to?

echo $SYBASE_ASE

ASE-15_0
g. What is the $DSQUERY variable set to?

echo $DSQUERY

DUB303_2K

  
The UNIX machines in Sybase Learning Centers have two ASE 15 servers already installed for each student. The name of the “primary” ASE for each student corresponds to the respective UNIX login name. For example if your UNIX login is dub303, then your “primary” ASE is named DUB303_2K and it is associated with the $DSQUERY environment variable. The second ASE is named DUB303_8K.
The difference between the two servers is the page size used. DUB303_2K uses a 2K page size while DUB303_8K uses an 8K page size.
Unless otherwise instructed, you will be performing all exercises on $DSQUERY, (in this case, DUB303_2K). Feel free to explore the 8K page server for any comparisons that you would like to make.2. In Window B, examine the Adaptive Server environment.
a. Change the directory to $SYBASE/$SYBASE_ASE/install.

cd $SYBASE/$SYBASE_ASE/install

b. List the files in the $SYBASE/$SYBASE_ASE/install directory.

ls

auditinit         DUB303_2K.log  RUN_DUB303_2K_BS  setperm_monserv  sybhauser
auditinit.sym     DUB303_8K.log  RUN_DUB303_8K     showserver       veritas
DUB303_2K_BS.log  RUN_DUB303_2K  setperm_all       startserver

c. Examine the contents of the RUN file for your “primary” Adaptive Server.

  
Remember, your “primary” Adaptive Server name is the 2K server. For student dub303, this would be DUB303_2K. The RUN file-naming convention is RUN_$DSQUERY
Use any available operating system command (vi, cat, more) to view the contents of the file.
cat RUN_$DSQUERY

#!/bin/sh
#
# ASE page size (KB):   2K
# Master device path:   /home/usr/u/dub303/devices/2Kmaster.dat
# Error log path:       /home/usr/u/dub303/ASE-15_0/install/DUB303_2K.log
# Configuration file path:      /home/usr/u/dub303/ASE-15_0/DUB303_2K.cfg
# Directory for shared memory files:    /home/usr/u/dub303/ASE-15_0
# Adaptive Server name: DUB303_2K
#
/home/usr/u/dub303/ASE-15_0/bin/dataserver \
-d/home/usr/u/dub303/devices/2Kmaster.dat \
-e/home/usr/u/dub303/ASE-15_0/install/DUB303_2K.log \
-c/home/usr/u/dub303/ASE-15_0/DUB303_2K.cfg \
-M/home/usr/u/dub303/ASE-15_0 \
-sDUB303_2K \        

   
What is the location of the master device?
/home/usr/u/dub303/devices/2Kmaster.dat
What is the name and location of the Adaptive Server errorlog? 
/home/usr/u/dub303/ASE-15_0/install/DUB303_2K.log3. Examine the lab environment for this course.
a. Change the directory to $HOME/ptquery15.

cd $HOME/ptquery15
b. Perform a directory listing by using the command ls. (Your results may be slightly different)

ls -1

addserver.sql
addusers.sql*
apf_warmup.sh*
ap_setup.sql*
…output deleted…

                                              


  There are about 100 files to support the lab environment for this course. You will be instructed exactly how and when to use these scripts.
Note some of the major file extensions shown and try to determine what you think they indicate about the purposes of the files:
.sh
These are UNIX shell scripts.
.bcp
Data files used to load ASE database tables with the bcp utility.
.sql
These are T-SQL command scripts which are typically invoked by using “isql -i” or imported directly into the isql command prompt.
   
You do not need to perform the setup for this course!!!!
The lab environment setup script, ptconfig15_setup.sh, has already been executed by the Sybase Education System Administrator.
The setup script created two new database devices, pubtune_data and pubtune_log, and created and loaded a user database, pubtune_db, on these devices.
4. In Window B, determine whether your Adaptive Server is up and running and, if not, start it up.
a. At the UNIX prompt, execute the showserver command.



   
Your output from this command is likely to be very different from that shown in the solutions for this lab. You may see Adaptive Servers up and running, but they may be for other students. This solutions for this lab show that students dub106 and dub104 have already started their servers. Your Adaptive Server should not be running yet.
You can filter showserver output by using the grep command:
    showserver | grep $LOGNAME
showserver

UID   PID  PPID  C    STIME TTY       TIME COMMAND
0 S dub106   29689 29688  0  75   0    - 24170 -      Nov30 ?        00:15:11 /h
ome/usr/u/dub106/ASE-15_0/bin/dataserver -d/home/usr/u/dub106/devices/2Kmaster.d
at -e/home/usr/u/dub106/ASE-15_0/install/DUB106_2K.log -c/home/usr/u/dub106/ASE-
15_0/DUB106_2K.cfg -M/home/usr/u/dub106/ASE-15_0 -sDUB106_2K
0 S dub104   29020 29019  0  75   0    - 37134 -      Nov29 ?        00:17:31 /h
ome/usr/u/dub104/ASE-15_0/bin/dataserver -d/home/usr/u/dub104/devices/2Kmaster.d
at -e/home/usr/u/dub104/ASE-15_0/install/DUB104_2K.log -c/home/usr/u/dub104/ASE-
15_0/DUB104_2K.cfg -M/home/usr/u/dub104/ASE-15_0 -sDUB104_2K

showserver | grep $LOGNAME

b. Try to log into your primary Adaptive Server, $DSQUERY, by using isql with the sa login, which has a NULL password.


Note: Do NOT change the password for the sa; leave it as NULL. You will be running script files that depend on this default setup.
isql -Usa -P -S$DSQUERY

CT-LIBRARY error:
        ct_connect(): network packet layer: internal net library error: Net-Lib
protocol driver call to connect two endpoints failed
c. In Window B, start up your Adaptive Server.

cd $SYBASE/$SYBASE_ASE/install
startserver -f RUN_$DSQUERY

00:00000:00000:2008/02/29 19:43:08.55 kernel  SySAM: Using licenses from: /home/usr/u/man101/SYSAM-2_0/l
icenses
00:00000:00000:2008/02/29 19:43:10.43 kernel  SySAM: Checked out license for 1 ASE_CORE (2007.08150/15-aug-2007/106B 8C32
9B38 21FD) will expire Thu Aug 16 00:00:00 2007.
00:00000:00000:2008/02/29 19:43:10.43 kernel  Error: 131274, Severity: 17, State: 1
00:00000:00000:2008/02/29 19:43:10.43 kernel  SySAM: WARNING: ASE will shutdown on Thu Aug 16 00:00:00 2007, unless a suit
able ASE_CORE license is obtained before that date.
 ...              
.
. (output shortened)
.
00:00000:00001:2008/02/29 19:43:13.58 server  Recovery has restored the original size for '16K' pool and '2K' pool in 'def
ault data cache'.
00:00000:00001:2008/02/29 19:43:13.58 server  Recovery complete.
00:00000:00001:2008/02/29 19:43:13.58 server  ASE's default unicode sort order is 'binary'.
00:00000:00001:2008/02/29 19:43:13.58 server  ASE's default sort order is:
00:00000:00001:2008/02/29 19:43:13.58 server    'bin_iso_1' (ID = 50)
00:00000:00001:2008/02/29 19:43:13.58 server  on top of default character set:
00:00000:00001:2008/02/29 19:43:13.58 server    'iso_1' (ID = 1).
00:00000:00001:2008/02/29 19:43:13.58 server  Master device size: 50 megabytes, or 25600 virtual pages. (A virtual page is
 2048 bytes.)


5. Explore your Adaptive Server.
a. In Window A, log in to Adaptive Server using the sa login, which has a NULL password.


Note: Do NOT change the password for the sa; leave it as NULL. You will be running script files that depend on this default setup.
isql -Usa -P -S$DSQUERY
b. While logged into Adaptive Server as the sa, verify that the ASE version is 15.0 by examining the global variable @@version.

select @@version

 ----------------
Adaptive Server Enterprise/15.0.2/EBF 15388 ESD#3/P/Linux Intel/Linux 2.4.21-47.ELsmp i686/ase1502/2527/32-bit/FBO/Tue Mar 11 11:19:44 2008

c. Determine what database devices your Adaptive Server currently has by using sp_helpdevice.

sp_helpdevice


 device_name  physical_name
         description                                                                            status cntrltype
         vdevno      vpn_low     vpn_high
 ------------ -------------------------------------------
         -------------------------------------------------------------------------------------- ------ ---------
         ----------- ----------- -----------
 master       /home/usr/u/man101/devices/2Kmaster.dat
         special, dsync on, directio off, default disk, physical disk, 50.00 MB, Free: 16.00 MB      3         0
                   0           0       25599
 pubtune_data /home/usr/u/man101/devices/pubtune_data.dat
         special, dsync on, directio off, physical disk, 50.00 MB, Free: 0.00 MB                 16386         0
                   8           0       25599
 pubtune_log  /home/usr/u/man101/devices/pubtune_log.dat
         special, dsync on, directio off, physical disk, 10.00 MB, Free: 0.00 MB                 16386         0
                   9           0        5119
 sysprocsdev  /home/usr/u/man101/devices/2Ksybprocs.dat
         special, dsync on, directio off, physical disk, 120.00 MB, Free: 0.00 MB                16386         0
                   1           0       61439
 systemdbdev  /home/usr/u/man101/devices/2Ksybdb.dat
         special, dsync on, directio off, physical disk, 1.00 MB, Free: 0.00 MB                  16386         0
                   2           0         511

(5 rows affected)

(return status = 0)

d. Determine what databases your Adaptive Server currently has by using sp_helpdb.

sp_helpdb


name           db_size       owner dbid  created      status                                                               
-------------- ------------- ----- ----- ------------ -------------------------------------------------------------------- 
master               13.0 MB sa        1 Apr 10, 2008 mixed log and data                                                   
model                 3.0 MB sa        3 Apr 10, 2008 mixed log and data                                                   
pubs2                 4.0 MB sa        4 Apr 10, 2008 trunc log on chkpt, mixed log and data                               
pubtune_db           60.0 MB sa        5 Apr 11, 2008 select into/bulkcopy/pllsort, trunc log on chkpt                     
sybsystemdb           4.0 MB sa    31513 Apr 10, 2008 mixed log and data                                                   
sybsystemprocs      132.0 MB sa    31514 Apr 10, 2008 trunc log on chkpt, mixed log and data                               
tempdb                4.0 MB sa        2 Apr 11, 2008 select into/bulkcopy/pllsort, trunc log on chkpt, mixed log and data

e. Verify that the pubtune_db database resides on the pubtune_data and pubtune_log devices by using sp_helpdb.

sp_helpdb pubtune_db

name       db_size       owner dbid created      status                                           
---------- ------------- ----- ---- ------------ ------------------------------------------------ 
pubtune_db       60.0 MB sa       5 Apr 11, 2008 select into/bulkcopy/pllsort, trunc log on chkpt 


device_fragments               size          usage                created                   free kbytes      
------------------------------ ------------- -------------------- ------------------------- ---------------- 
pubtune_data                         50.0 MB data only            Apr 11 2008  6:03AM                  37766 
pubtune_log                          10.0 MB log only             Apr 11 2008  6:03AM       not applicable   
                                                               
-------------------------------------------------------------- 
log only free kbytes = 10198                                   


device       segment    
------------ ---------- 
pubtune_data default    
pubtune_data system     
pubtune_log  logsegment


  
Does it appear that the lab setup for this course was successful? Specifically, does the pubtune_db database and its associated devices, pubtune_data and pubtune_log, exist?
Yes. The lab setup was successful. The pubtune_db database and its associated devices, pubtune_data and pubtune_log, exist.
6. Confirm that you can reboot your Adaptive Server.
a. Shut down your Adaptive Server.

shutdown


Server SHUTDOWN by request.
ASE is terminating this process.
00:00000:00011:2008/02/29 19:57:05.54 server  ASE shutdown by request.
00:00000:00011:2008/02/29 19:57:05.54 kernel  ueshutdown: exiting
00:00000:00011:2008/02/29 19:57:05.70 kernel  SySAM: Checked in license for 1 ASE_CORE (2007.08150/15-aug-2007/106B 8C32 9
B38 21FD).
CT-LIBRARY error:
        ct_results(): network packet layer: internal net library error: Net-Library operation terminated due to disconnect


b. In Window B, start up your Adaptive Server.

cd $SYBASE/$SYBASE_ASE/install

startserver -f RUN_$DSQUERY



00:00000:00000:2008/02/29 19:43:08.55 kernel  SySAM: Using licenses from: /home/usr/u/man101/SYSAM-2_0/l
icenses
00:00000:00000:2008/02/29 19:43:10.43 kernel  SySAM: Checked out license for 1 ASE_CORE (2007.08150/15-aug-2007/106B 8C32
9B38 21FD) will expire Thu Aug 16 00:00:00 2007.
00:00000:00000:2008/02/29 19:43:10.43 kernel  Error: 131274, Severity: 17, State: 1
00:00000:00000:2008/02/29 19:43:10.43 kernel  SySAM: WARNING: ASE will shutdown on Thu Aug 16 00:00:00 2007, unless a suit
able ASE_CORE license is obtained before that date.
 ...              
.
. (output shortened)
.
00:00000:00001:2008/02/29 19:43:13.58 server  Recovery has restored the original size for '16K' pool and '2K' pool in 'def
ault data cache'.
00:00000:00001:2008/02/29 19:43:13.58 server  Recovery complete.
00:00000:00001:2008/02/29 19:43:13.58 server  ASE's default unicode sort order is 'binary'.
00:00000:00001:2008/02/29 19:43:13.58 server  ASE's default sort order is:
00:00000:00001:2008/02/29 19:43:13.58 server    'bin_iso_1' (ID = 50)
00:00000:00001:2008/02/29 19:43:13.58 server  on top of default character set:
00:00000:00001:2008/02/29 19:43:13.58 server    'iso_1' (ID = 1).
00:00000:00001:2008/02/29 19:43:13.58 server  Master device size: 50 megabytes, or 25600 virtual pages. (A virtual page is
 2048 bytes.)



7. The messages output from the server may be more than you wish to contend with during the run of the course.  If the messages get in the way of your lab work, close the window that started the server and open a new one.  The messages will not be sent to new window.










